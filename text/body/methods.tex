\documentclass[tcc]{subfiles}

\begin{document}

\chapter{Methods}
\label{sec:methods}
\epigraph{It's not denial. \\ I'm just very selective about the reality I accept.}{-Calvin}

This section deals with the models used for the engine compressor, turbine and nozzle, 
as well as the methods used for calculating the engine steady operation (engine matching), 
surge, dynamical behaviour and performance parameters. 
Throught this section, the ideal gas assumption is widely used, 
as is the assumption that the performance of a component can be separated in an ideal performance and a loss model. In the end, a brief decription of the engine from which the parameters for the model were extracted is described.

\section{Compressor model}

\subfile{text/body/compressor_map}


To write Euler's equation \cref{eqn:euler} in terms of the nondimensional parameters introduced in \cref{sec:nondimensional}, it suffices to rewrite $\phi_3$ and $\psi$ as a function of them. Thus
\begin{multline}
    \label{eqn:phi2_dimensionless}
    \phi_3 = \frac{W_{2r}}{U_3} 
           = \frac{\frac{\dot{m}}{\rho_3 A2}}{\acs{M0rotor} a_{02}}
           = \frac{\MFPalt{2}}{\acs{M0rotor}} \frac{a_{03}}{a_{02}} \stagdensratio{3} \\ 
           = \frac{\acs{MFP}_3}{\acs{M0rotor}} \sqrt{\frac{T_{03}}{T_{01}}} \stagdensratio{3}
\end{multline}
The value of $M_3$ can be obtained from $\acs{MFP}_3$ using \cref{eqn:mfp2mach}, while the latter is given by
\begin{equation}
    \label{eqn:mfp2mfp2}
    \acs{MFP}_3 \triangleq \MFP{2} = \acs{MFP} \frac{A_2}{A_3} \frac{P_{02}}{P_{03}} \sqrt{\frac{T_{03}}{T_{02}}}
\end{equation}
Notice that \cref{eqn:mfp2mfp2} makes no assumption of the process 1--2 being isentropic. $\acs{MFP}_3$ can be used along with \acs{MFP} to check for choking.

The load coefficient is given by
\begin{equation}
    \acs{load_coef}\triangleq \frac{\Delta h}{U_3^2}
                      = \frac{c_p(T_{02}-T_{02})}{U_3^2}
                      = \frac{\frac{c_p(T_{03}-T_{01})}{\gamma R T_{02}}}
                                    {\acs{M0rotor}^2}
                      = \frac{\frac{T_{03}}{T_{02}}-1}
                                  {\acs{M0rotor}^2}
                        \left(\frac{1}{\gamma-1}\right)
\end{equation}

At this point the loss models discussed in \cref{sec:compressor_losses} are introduced, 
and the values of $\acs{load_coef}_{\text{actual}}$ and $\acs{load_coef}_{\text{isen}}$ are obtained.
The temperature and pressure ratios can then be readily calculated from
\begin{align}
    \label{eqn:psi2Tratio}
    \frac{T_{03}}{T_{02}} &= (\gamma - 1)\psi_{\text{actual}} \acs{M0rotor}^2 + 1 \\
    \label{eqn:psi2Pratio}
    \frac{P_{03}}{P_{02}} &= \left[(\gamma - 1)\psi_{\text{isen}} \acs{M0rotor}^2 + 1\right]^\frac{\gamma}{\gamma-1}
\end{align}

In this work, only the losses due to incidence and skin friction were considered, because they are the ones most important for compressor stability (see \cref{sec:compressor_loss}). The model chosen for skin friction was suggest by \textcite{Oh1997} and the incidence losses where modelled as the complete conversion of all kinetic energy normal to be blade camber line to heat \cite{Galvas1973}. This is a more phisical model than the one suggested by Oh et al., and captures better the loss variation with incidence, since Oh et al's model does not include flow angles. 


\section{Turbine model}
\subfile{text/body/turbine_map}

The turbine model is sumarized in \cref{map:turbine}. 
Its development is mostly analogous to that of the compressor, with the exception of the loss and deviation models. 
Since the turbine does not exhibit flow instability phenomena such as compressor surge, 
which depends heavly on the incidence losses, 
and this work is focussed on the dynamic moddeling of the engine, 
the turbine was assumed isentropic. 
Nevertheless, a loss model based on pressure loss coefficients $Y_p$, $Y_s$, $Y_k$, etc.\ 
could easily be included in this model by modfying \cref{eqn:turb_res_pr} in the following way
\begin{equation}
    \frac{P_{05}}{P_{04}} -\frac{[1 + (\gamma-1)\psi_{\text{euler}} M_b^2]^{\frac{\gamma}{\gamma-1}}}{1+Y\left\{1-\left[1+\tfrac{\gamma-1}{2}M_5^2\right]^{-\frac{\gamma-1}{\gamma}}\right\}} = 0 
\end{equation}

where
\begin{equation}
    Y = Y_p + Y_s + Y_k
\end{equation}

This correction is derived as follows. The pressure loss coefficient is given by
\begin{equation}
    Y = \frac{P_{0i} - P_{0e}}{P_{0e} - P_e}
\end{equation}
Now we divide the numerator and the denominator by $P_{0e}$ and isolate the pressure ratio term 
\begin{equation}
    \frac{P_{0i}}{P_{0e}} = \frac{1}{1+Y\left\{1-\left[1+\tfrac{\gamma-1}{2}M_e^2\right]^{-\frac{\gamma-1}{\gamma}}\right\}}
\end{equation}
This pressure ratio loss term must be multiplied to the ideal (isentropic) pressure ratio given by the second term of \cref{eqn:turb_res_pr}. If more than one blade row is considered (e.g.\ one for the stator and another one for the rotor) the pressure ratio losses for each must be joined by multiplication.

\subfile{text/body/nozzle}


\section{Engine static model}


The engine static model, also known as steady state, 
describes the conditions in which the engine can operate indefinitelly 
without changes in throttle input or outside conditions (pressure and temperature).


Equations:
\begin{enumerate}
    \item Constant spool speed
    \item Conservation of energy transmited through spool
    \item Conservation of mass in the burner
    \item Energy adition due to fuel
    \item nozzle
    \item turbine (x3)
    \item compressor (x3)
\end{enumerate}

\subfile{text/body/engine_map}

\subsection{Performance parameters}
\begin{itemize}
    \item thrust
    \item thermal efficiency
\end{itemize}

\section{Engine dynamical model}
\begin{align}
    \dot{P}_{04} &= \frac{a_{01}^2}{\volume}(\dot{m}_c - \dot{m}_t) \\
    \ddot{m}_c &= \frac{A_1}{L_c}(P_{03}-P_{04}) \\
    \dot{\omega} &= \frac{1}{J} (\tau_t-\tau_c)
\end{align}

\section{Surge model}

The model due to \textcite{Finsk}, described in \cref{sec:review:surge} was adopted here. 
Since component matching is an important part of the surge mechanism, the engine matching model equations were mostly replicated here, with the exception of the nozzle equation since the exit pressure of the nozzle can be allowed to be arbitrary to consider all possible surge conditions. Surge will normally occur when the mass flow is severely reduced, which happens when the overall engine pressure ratio is big. This equation was replaced by Fink's stability criterion \cref{eqn:surge}. The resulting model is in \cref{model:surge}.

\section{Numerical aspects}
% Literary review (TODO: move this)
As will be shown in \cref{sec:methods}, 
the moddeling of a gas turbine engine and of its components can 
be conveniently described by nonlinear algebraic systems. 
There are two main approaches to solve these systems numerically: 
classical gradient based root finding and optimization 
and path following algorithms (\ac{DAE} solvers).

% Methods
\subsection{Generation of component maps}
Nonlinear solver (hybr or lm) coupled with a breadth-first search. Initial point in the $x$ and $y$-axis is chosen randomly within the choke boundaries, pressure and temperature ratios are unit, mach numbers are between 0 an 1. If convergence is achieved a breadth-first search considering that each point in the grid is a graph node connected to the points up, down, left, right and in the diagonals. The converged result for each point is used as an initial guess for neighboring points. This allows each point in the grid up to 8 different initial guesses quite close to the actual solution (if the grid is fine enougth), and has proven very robust. 

\subsubsection*{choke line}
Compressor: find point where inlet and exit are simultaniously choked. For pressure ratios above this critical value, only the inlet is choked and the choke line is vertical. For pressure ratios bellow this value the exit is choked. The choke line was verified to be a straight line, so that just the point at another pressure ratio, e.g.\ the minimum pressure ratio of interest (normally unit) is needed to fully define it.

Turbine: it is linear in a plot of \acs{MFP} vs.\ pressure ratio, but in this case the blade mach number is not uniquelly defined. In a plot of $\acs{MFP}M_b$ vs.\ expansion ratio, the choke line is highly non linear and a KS aggregation function with variable $rho$ was added to the turbine model to model the choke.  

\subsection{Generation of the working line}
Optimize the engine model for maximum efficiency. 
Then use a \ac{DAE} solver to continue the line forwards and backwards.

\subsection{Dynamical simulation}
Inputs: step in T04 up and down; senoids?

\section{The VT-80 engine}
The engine chosen to which apply these models was Jet-Munts VT-80.

\end{document}
